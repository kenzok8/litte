import{k as G,c as t,K as $e,i as n,F as R,O as te,a9 as Te,aa as Ne,ab as Ee,ac as Oe,ad as ke,S as ve,b as P,d as m,a5 as X,a2 as ze,a3 as Ke,N as Ce,q as _e,ae as ne,af as Me,ag as Ge,m as Re,ah as je,ai as Le,aj as Ae,ak as Ve,Y as ce,h as q,j as He,p as Ue,a7 as Be,A as z,g as L,t as A,al as qe,am as We,M as Ye,P as Q,an as de,ao as ue,ap as Ze,aq as Je,D as Xe,e as Qe}from"./vendor-5507c805.js";import{c as et,g as tt,a as nt,b as st,d as rt,e as at,f as W,r as lt}from"./index-83f95c10.js";import{u as Y,B as T,d as ot,f as it,g as ct,T as dt,h as H,i as pe,j as Se,M as xe,k as se,m as ut,n as u,o as ge,p as me,q as fe,r as gt,v as mt,w as ft,x as bt}from"./index-bd53d7c8.js";import{C as ee}from"./ConfigTitle-dd5fc83b.js";import{f as ht}from"./global-9f47a568.js";const $t=m('<form><div class="join flex"><select name=sourceIP class="select join-item select-bordered"><option></option></select><input name=tagName class="input join-item input-bordered min-w-0 flex-1"placeholder=name>'),vt=m("<option class=badge>"),Ct=m('<div><div class="flex justify-between py-2"><div class="flex items-center gap-2"><span></span></div><input type=checkbox class=toggle>'),_t=m("<div>"),pt=m('<div class="flex flex-col gap-4"><div><select class="select select-bordered w-full"></select></div><div><div class="flex flex-col gap-4"><div class="flex flex-col gap-2"></div></div></div><div>'),St=m("<option>"),xt=m('<div class="badge badge-primary w-full items-center justify-between gap-2 py-4"><span class=truncate> (<!>)'),It=()=>{const r=X.object({tagName:X.string().nonempty(),sourceIP:X.string().nonempty()}),[g]=Y(),{form:a,reset:C}=ze({extend:Ke({schema:r}),onSubmit:({tagName:h,sourceIP:y})=>{pe(_=>_.some(o=>o.tagName===h||o.sourceIP===y)?_:[..._,{tagName:h,sourceIP:y}]),C()}});return(()=>{const h=$t(),y=h.firstChild,_=y.firstChild;return _.firstChild,_.nextSibling,Ce(a,h,()=>a),n(_,t(ne,{get each(){return _e.uniq(se().map(({metadata:{sourceIP:o}})=>o)).sort().filter(o=>!H().some(({sourceIP:i})=>i===o))},children:o=>(()=>{const i=vt();return n(i,o),P(()=>i.value=o()),i})()}),null),n(y,t(T,{type:"submit",class:"join-item",get children(){return g("tag")}}),null),h})()},yt=r=>{const[g]=Y(),[a,C]=G(null),h=({draggable:o})=>C(o.id),y=({draggable:o,droppable:i})=>{if(o&&i){const p=r.order,f=p.indexOf(o.id),w=p.indexOf(i.id);if(f!==w){const S=p.slice();S.splice(w,0,...S.splice(f,1)),r.onOrderChange(S)}}},_=({key:o})=>{const i=Me(o),[p]=Ge();return(()=>{const f=Ct(),w=f.firstChild,S=w.firstChild,K=S.firstChild,b=S.nextSibling,F=i.ref;return typeof F=="function"?Ce(F,f):i.ref=f,n(S,t(T,Re({class:"btn-ghost btn-sm cursor-grab",get icon(){return t(je,{size:24})}},()=>i.dragActivators)),K),n(K,()=>g(o)),b.addEventListener("change",$=>{r.onVisibleChange({...r.visible,[o]:$.target.checked})}),P($=>{const N=!!i.isActiveDraggable,I=!!p.active.draggable,E=Le(i.transform);return N!==$._v$&&f.classList.toggle("opacity-25",$._v$=N),I!==$._v$2&&f.classList.toggle("transition-transform",$._v$2=I),$._v$3=Ae(f,E,$._v$3),$},{_v$:void 0,_v$2:void 0,_v$3:void 0}),P(()=>b.checked=r.visible[o]),f})()};return t(xe,{ref:o=>{var i;return(i=r.ref)==null?void 0:i.call(r,o)},get icon(){return t($e,{size:24})},get title(){return g("connectionsSettings")},get action(){return t(T,{class:"btn-neutral btn-sm",onClick:()=>{r.onOrderChange(ot),r.onVisibleChange(it)},get children(){return g("reset")}})},get children(){const o=pt(),i=o.firstChild,p=i.firstChild,f=i.nextSibling,w=f.firstChild,S=w.firstChild,K=f.nextSibling;return n(i,t(ee,{withDivider:!0,get children(){return g("tableSize")}}),p),p.addEventListener("change",b=>ct(b.target.value)),n(p,t(R,{get each(){return Object.values(dt)},children:b=>(()=>{const F=St();return F.value=b,n(F,()=>g(b)),F})()})),n(f,t(ee,{withDivider:!0,get children(){return g("tagClientSourceIPWithName")}}),w),n(w,t(It,{}),S),n(S,t(R,{get each(){return H()},children:({tagName:b,sourceIP:F})=>(()=>{const $=xt(),N=$.firstChild,I=N.firstChild,E=I.nextSibling;return E.nextSibling,n(N,b,I),n(N,F,E),n($,t(T,{class:"btn-circle btn-ghost btn-xs",onClick:()=>pe(j=>j.filter(Z=>Z.tagName!==b)),get icon(){return t(te,{size:12})}}),null),$})()})),n(K,t(ee,{withDivider:!0,get children(){return g("sort")}}),null),n(K,t(Te,{onDragStart:h,onDragEnd:y,collisionDetector:Ne,get children(){return[t(Ee,{}),t(Oe,{get ids(){return r.order},get children(){return t(R,{get each(){return r.order},children:b=>t(_,{key:b})})}}),t(ke,{get children(){return t(ve,{get when(){return a()},get children(){const b=_t();return n(b,()=>g(a())),b}})}})]}}),null),P(()=>p.value=Se()),o}})},wt=m("<pre><code>"),Ft=r=>{const[g]=Y();return t(xe,{ref:a=>{var C;return(C=r.ref)==null?void 0:C.call(r,a)},get icon(){return t($e,{size:24})},get title(){return g("connectionsDetails")},get children(){return t(ve,{get when(){return r.selectedConnectionID},get children(){const a=wt(),C=a.firstChild;return n(C,()=>JSON.stringify(se().find(({id:h})=>h===r.selectedConnectionID),null,2)),a}})}})};var Dt=async r=>{typeof r=="string"?await navigator.clipboard.writeText(r):await navigator.clipboard.write(r)};const be=m('<div class="flex h-4 items-center">'),Pt=m('<div class="flex h-full flex-col gap-2"><div class="flex w-full flex-wrap items-center gap-2"><div class="flex items-center gap-2"><div class="tabs-boxed tabs gap-2"></div><select class="select select-bordered select-primary select-sm w-full max-w-full flex-1 sm:select-md"><option value=""></option></select></div><div class="join flex flex-1 items-center md:flex-1"><input type=search class="input join-item input-primary input-sm min-w-0 flex-1 sm:input-md"></div></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),Tt=m('<button><span></span><div class="badge badge-sm">'),Nt=m("<option>"),Et=m("<tr>"),Ot=m("<th class=bg-base-200><div><div>"),kt=m("<button class=cursor-pointer>"),zt=m('<tr class="hover:!bg-primary hover:text-primary-content">'),Kt=m("<td class=py-2>"),Mt=m("<button><div></div><div></div><div>(<!>)");var V=function(r){return r[r.activeConnections=0]="activeConnections",r[r.closedConnections=1]="closedConnections",r}(V||{});const he=(r,g,a,C)=>{const h=lt(r.getValue(g),a);return C({itemRank:h}),h.passed},Vt=()=>{let r,g;const[a]=Y(),[C,h]=G(V.activeConnections),{activeConnections:y,closedConnections:_,paused:o,setPaused:i}=ut(),[p,f]=G(""),[w,S]=G(),K=[{header:()=>a("details"),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:u.Details,cell:({row:e})=>(()=>{const c=be();return n(c,t(T,{class:"btn-circle btn-xs",onClick:()=>{S(e.original.id),g==null||g.showModal()},get icon(){return t(Ve,{size:"16"})}})),c})()},{header:()=>a("close"),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:u.Close,cell:({row:e})=>(()=>{const c=be();return n(c,t(T,{class:"btn-circle btn-xs",onClick:()=>ge(e.original.id),get icon(){return t(te,{size:"16"})}})),c})()},{header:()=>a("ID"),enableGrouping:!1,accessorKey:u.ID,accessorFn:e=>e.id},{header:()=>a("type"),accessorKey:u.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{header:()=>a("process"),accessorKey:u.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{header:()=>a("host"),accessorKey:u.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{header:()=>a("sniffHost"),accessorKey:u.SniffHost,accessorFn:e=>e.metadata.sniffHost||"-"},{header:()=>a("rules"),accessorKey:u.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{header:()=>a("chains"),accessorKey:u.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{header:()=>a("connectTime"),enableGrouping:!1,accessorKey:u.ConnectTime,accessorFn:e=>ht(e.start),sortingFn:(e,c)=>ce(e.original.start).valueOf()-ce(c.original.start).valueOf()},{header:()=>a("dlSpeed"),enableGrouping:!1,accessorKey:u.DlSpeed,accessorFn:e=>`${q(e.downloadSpeed)}/s`,sortingFn:(e,c)=>e.original.downloadSpeed-c.original.downloadSpeed},{header:()=>a("ulSpeed"),enableGrouping:!1,accessorKey:u.ULSpeed,accessorFn:e=>`${q(e.uploadSpeed)}/s`,sortingFn:(e,c)=>e.original.uploadSpeed-c.original.uploadSpeed},{header:()=>a("dl"),enableGrouping:!1,accessorKey:u.Download,accessorFn:e=>q(e.download),sortingFn:(e,c)=>e.original.download-c.original.download},{header:()=>a("ul"),enableGrouping:!1,accessorKey:u.Upload,accessorFn:e=>q(e.upload),sortingFn:(e,c)=>e.original.upload-c.original.upload},{header:()=>a("sourceIP"),accessorKey:u.SourceIP,accessorFn:e=>{const c=H().find(U=>U.sourceIP===e.metadata.sourceIP);return c?c.tagName:e.metadata.sourceIP}},{header:()=>a("sourcePort"),accessorKey:u.SourcePort,accessorFn:e=>e.metadata.sourcePort},{header:()=>a("destination"),accessorKey:u.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host},{header:()=>a("inboundUser"),accessorKey:u.InboundUser,accessorFn:e=>e.metadata.inboundUser||e.metadata.inboundName||e.metadata.inboundPort}],[b,F]=G([]),[$,N]=He(G([{id:u.ConnectTime,desc:!0}]),{name:"connectionsTableSorting",storage:localStorage}),I=et({filterFns:{fuzzy:he},state:{get columnOrder(){return me()},get grouping(){return b()},get sorting(){return $()},get columnVisibility(){return fe()},get globalFilter(){return p()}},get data(){return C()===V.activeConnections?y():_()},sortDescFirst:!0,enableHiding:!0,columns:K,onGlobalFilterChange:f,globalFilterFn:he,onGroupingChange:F,onSortingChange:N,getFilteredRowModel:tt(),getSortedRowModel:nt(),getExpandedRowModel:st(),getGroupedRowModel:rt(),getCoreRowModel:at()}),E=I.getFlatHeaders().find(({id:e})=>e===u.SourceIP),[j,Z]=G("");Ue(Be(j,()=>{const e=H().find(c=>c.sourceIP===j());E==null||E.column.setFilterValue(e?e.tagName:j())}));const Ie=z(()=>[{type:V.activeConnections,name:a("active"),count:y().length},{type:V.closedConnections,name:a("closed"),count:_().length}]);return(()=>{const e=Pt(),c=e.firstChild,U=c.firstChild,re=U.firstChild,J=re.nextSibling,ye=J.firstChild,B=U.nextSibling,ae=B.firstChild,we=c.nextSibling,le=we.firstChild,oe=le.firstChild,Fe=oe.nextSibling;return n(re,t(ne,{get each(){return Ie()},children:s=>(()=>{const d=Tt(),l=d.firstChild,O=l.nextSibling;return d.$$click=()=>h(s().type),n(l,()=>s().name),n(O,()=>s().count),P(()=>L(d,A(C()===s().type&&"tab-active","tab tab-sm gap-2 sm:tab-md"))),d})()})),J.addEventListener("change",s=>Z(s.target.value)),n(ye,()=>a("all")),n(J,t(ne,{get each(){return _e.uniq(se().map(({metadata:{sourceIP:s}})=>{const d=H().find(l=>l.sourceIP===s);return d?d.tagName:s})).sort()},children:s=>(()=>{const d=Nt();return n(d,s),P(()=>d.value=s()),d})()}),null),ae.$$input=s=>f(s.target.value),n(B,t(T,{class:"join-item btn-sm sm:btn-md",onClick:()=>i(s=>!s),get icon(){return z(()=>!!o())()?t(qe,{}):t(We,{})}}),null),n(B,t(T,{class:"join-item btn-sm sm:btn-md",onClick:()=>{I.getState().globalFilter?I.getFilteredRowModel().rows.forEach(({id:s})=>ge(s)):gt()},get icon(){return t(te,{})}}),null),n(B,t(T,{class:"btn join-item btn-sm sm:btn-md",onClick:()=>r==null?void 0:r.showModal(),get icon(){return t(Ye,{})}}),null),n(oe,t(R,{get each(){return I.getHeaderGroups()},children:s=>(()=>{const d=Et();return n(d,t(R,{get each(){return s.headers},children:l=>(()=>{const O=Ot(),k=O.firstChild,v=k.firstChild;return n(k,(()=>{const x=z(()=>!!l.column.getCanGroup());return()=>x()?(()=>{const D=kt();return Q(D,"click",l.column.getToggleGroupingHandler(),!0),n(D,(()=>{const M=z(()=>!!l.column.getIsGrouped());return()=>M()?t(de,{size:18}):t(ue,{size:18})})()),D})():null})(),v),Q(v,"click",l.column.getToggleSortingHandler(),!0),n(v,()=>W(l.column.columnDef.header,l.getContext())),n(k,()=>({asc:t(Ze,{}),desc:t(Je,{})})[l.column.getIsSorted()]??null,null),P(x=>{const D=A("flex items-center gap-2"),M=A(l.column.getCanSort()&&"cursor-pointer select-none","flex-1");return D!==x._v$3&&L(k,x._v$3=D),M!==x._v$4&&L(v,x._v$4=M),x},{_v$3:void 0,_v$4:void 0}),O})()})),d})()})),n(Fe,t(R,{get each(){return I.getRowModel().rows},children:s=>(()=>{const d=zt();return n(d,t(R,{get each(){return s.getVisibleCells()},children:l=>(()=>{const O=Kt();return O.$$contextmenu=k=>{k.preventDefault();const v=l.renderValue();v&&Dt(v).catch(()=>{})},n(O,(()=>{const k=z(()=>!!l.getIsGrouped());return()=>k()?(()=>{const v=Mt(),x=v.firstChild,D=x.nextSibling,M=D.nextSibling,De=M.firstChild,ie=De.nextSibling;return ie.nextSibling,Q(v,"click",s.getToggleExpandedHandler(),!0),n(x,(()=>{const Pe=z(()=>!!s.getIsExpanded());return()=>Pe()?t(de,{size:18}):t(ue,{size:18})})()),n(D,()=>W(l.column.columnDef.cell,l.getContext())),n(M,()=>s.subRows.length,ie),P(()=>L(v,A(s.getCanExpand()?"cursor-pointer":"cursor-normal","flex items-center gap-2"))),v})():(()=>{const v=z(()=>!!l.getIsAggregated());return()=>v()?W(l.column.columnDef.aggregatedCell??l.column.columnDef.cell,l.getContext()):(()=>{const x=z(()=>!!l.getIsPlaceholder());return()=>x()?null:W(l.column.columnDef.cell,l.getContext())})()})()})()),O})()})),d})()})),n(e,t(yt,{ref:s=>r=s,get order(){return me()},get visible(){return fe()},onOrderChange:s=>mt(s),onVisibleChange:s=>ft({...s})}),null),n(e,t(Ft,{ref:s=>g=s,get selectedConnectionID(){return w()}}),null),P(s=>{const d=a("search"),l=A(bt(Se()),"table table-zebra relative rounded-none");return d!==s._v$&&Xe(ae,"placeholder",s._v$=d),l!==s._v$2&&L(le,s._v$2=l),s},{_v$:void 0,_v$2:void 0}),e})()};Qe(["input","click","contextmenu"]);export{Vt as default};
