import{r as D,R as m,P as j,j as t,s as E,h as _,c as W,i as H,k as P,l as L,n as G,d as R,o as q,g as $,q as F,t as J,v as y,w as K,u as Q,C as X,x as Y,B as Z,y as ee,z as te}from"./index-aa3f8ed9.js";import{r as ne}from"./logs-253cb530.js";import{S as b}from"./Select-81600379.js";function w(){return w=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},w.apply(this,arguments)}function se(e,a){if(e==null)return{};var r=ae(e,a),o,s;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(s=0;s<l.length;s++)o=l[s],!(a.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}function ae(e,a){if(e==null)return{};var r={},o=Object.keys(e),s,l;for(l=0;l<o.length;l++)s=o[l],!(a.indexOf(s)>=0)&&(r[s]=e[s]);return r}var k=D.forwardRef(function(e,a){var r=e.color,o=r===void 0?"currentColor":r,s=e.size,l=s===void 0?24:s,d=se(e,["color","size"]);return m.createElement("svg",w({ref:a,xmlns:"http://www.w3.org/2000/svg",width:l,height:l,viewBox:"0 0 24 24",fill:"none",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),m.createElement("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),m.createElement("polyline",{points:"16 17 21 12 16 7"}),m.createElement("line",{x1:"21",y1:"12",x2:"9",y2:"12"}))});k.propTypes={color:j.string,size:j.oneOfType([j.string,j.number])};k.displayName="LogOut";const oe=k,{useState:re,useRef:le,useEffect:ce,useCallback:ie}=_;function de(e){return t.jsx("input",{className:E.input,...e})}function ue({value:e,...a}){const[r,o]=re(e),s=le(e);ce(()=>{s.current!==e&&o(e),s.current=e},[e]);const l=ie(d=>o(d.target.value),[o]);return t.jsx("input",{className:E.input,value:r,onChange:l,...a})}const pe="_root_165du_1",he="_section_165du_2",ge="_wrapSwitch_165du_26",fe="_sep_165du_32",xe="_label_165du_45",c={root:pe,section:he,wrapSwitch:ge,sep:fe,label:xe},me="_fieldset_1ghjp_1",je="_input_1ghjp_9",ve="_cnt_1ghjp_9",C={fieldset:me,input:je,cnt:ve};function ye({OptionComponent:e,optionPropsList:a,selectedIndex:r,onChange:o}){const s=W("visually-hidden",C.input),l=d=>{o(d.target.value)};return t.jsx("fieldset",{className:C.fieldset,children:a.map((d,p)=>t.jsxs("label",{children:[t.jsx("input",{type:"radio",checked:r===p,name:"selection",value:p,"aria-labelledby":"traffic chart type "+p,onChange:l,className:s}),t.jsx("div",{className:C.cnt,children:t.jsx(e,{...d})})]},p))})}const{useMemo:be}=_,Ce={plugins:{legend:{display:!1}},scales:{x:{display:!1,type:"category"},y:{display:!1,type:"linear"}}},T=[23e3,35e3,46e3,33e3,9e4,68e3,23e3,45e3],we=[184e3,183e3,196e3,182e3,19e4,186e3,182e3,189e3],_e=T;function ke({id:e}){const a=H.read(),r=be(()=>({labels:_e,datasets:[{...P,...L[e].up,data:T},{...P,...L[e].down,data:we}]}),[e]),o="chart-"+e;return G(a.Chart,o,r,null,Ce),t.jsx("div",{style:{width:100,padding:5},children:t.jsx("canvas",{id:o})})}const{useEffect:M,useState:Se,useCallback:g,useRef:Oe,useMemo:Ne}=_,Ie=[{id:0},{id:1},{id:2},{id:3}],Pe=[["debug","Debug"],["info","Info"],["warning","Warning"],["error","Error"],["silent","Silent"]],Le=[{key:"port",label:"HTTP Proxy Port"},{key:"socks-port",label:"SOCKS5 Proxy Port"},{key:"mixed-port",label:"Mixed Port"},{key:"redir-port",label:"Redir Port"}],Ee=[["zh","中文"],["en","English"]],Re=[["Global","Global"],["Rule","Rule"],["Direct","Direct"]],$e=e=>({configs:q(e),apiConfig:$(e)}),Te=e=>({selectedChartStyleIndex:ee(e),latencyTestUrl:te(e),apiConfig:$(e)}),Me=R(Te)(Ae),De=R($e)(ze);function ze({dispatch:e,configs:a,apiConfig:r}){return M(()=>{e(F(r))},[e,r]),t.jsx(Me,{configs:a})}function Ae({dispatch:e,configs:a,selectedChartStyleIndex:r,latencyTestUrl:o,apiConfig:s}){const[l,d]=Se(a),p=Oe(a);M(()=>{p.current!==a&&d(a),p.current=a},[a]);const z=g(()=>{e(J("apiConfig"))},[e]),f=g((n,i)=>{d({...l,[n]:i})},[l]),A=g(n=>{const i="allow-lan",u=n;f(i,u),e(y(s,{"allow-lan":u}))},[s,e,f]),x=g(({name:n,value:i})=>{switch(n){case"mode":case"log-level":f(n,i),e(y(s,{[n]:i})),n==="log-level"&&ne({...s,logLevel:i});break;case"redir-port":case"socks-port":case"mixed-port":case"port":if(i!==""){const u=parseInt(i,10);if(u<0||u>65535)return}f(n,i);break;default:return}},[s,e,f]),B=g(n=>x(n.target),[x]),{selectChartStyleIndex:U,updateAppConfig:S}=K(),O=g(n=>{const i=n.target,{name:u,value:I}=i;switch(u){case"port":case"socks-port":case"mixed-port":case"redir-port":{const v=parseInt(I,10);if(v<0||v>65535)return;e(y(s,{[u]:v}));break}case"latencyTestUrl":{S(u,I);break}default:throw new Error(`unknown input name ${u}`)}},[s,e,S]),V=Ne(()=>{const n=l.mode;return typeof n=="string"&&n[0].toUpperCase()+n.slice(1)},[l.mode]),{t:h,i18n:N}=Q();return t.jsxs("div",{children:[t.jsx(X,{title:h("Config")}),t.jsxs("div",{className:c.root,children:[Le.map(n=>l[n.key]!==void 0?t.jsxs("div",{children:[t.jsx("div",{className:c.label,children:n.label}),t.jsx(de,{name:n.key,value:l[n.key],onChange:B,onBlur:O})]},n.key):null),t.jsxs("div",{children:[t.jsx("div",{className:c.label,children:"Mode"}),t.jsx(b,{options:Re,selected:V,onChange:n=>x({name:"mode",value:n.target.value})})]}),t.jsxs("div",{children:[t.jsx("div",{className:c.label,children:"Log Level"}),t.jsx(b,{options:Pe,selected:l["log-level"],onChange:n=>x({name:"log-level",value:n.target.value})})]}),t.jsxs("div",{children:[t.jsx("div",{className:c.label,children:"Allow LAN"}),t.jsx("div",{className:c.wrapSwitch,children:t.jsx(Y,{name:"allow-lan",checked:l["allow-lan"],onChange:A})})]})]}),t.jsx("div",{className:c.sep,children:t.jsx("div",{})}),t.jsxs("div",{className:c.section,children:[t.jsxs("div",{children:[t.jsx("div",{className:c.label,children:h("latency_test_url")}),t.jsx(ue,{name:"latencyTestUrl",type:"text",value:o,onBlur:O})]}),t.jsxs("div",{children:[t.jsx("div",{className:c.label,children:h("lang")}),t.jsx("div",{children:t.jsx(b,{options:Ee,selected:N.language,onChange:n=>N.changeLanguage(n.target.value)})})]}),t.jsxs("div",{children:[t.jsx("div",{className:c.label,children:h("chart_style")}),t.jsx(ye,{OptionComponent:ke,optionPropsList:Ie,selectedIndex:r,onChange:U})]}),t.jsxs("div",{children:[t.jsxs("div",{className:c.label,children:[h("current_backend"),t.jsx("p",{children:s.baseURL})]}),t.jsx("div",{className:c.label,children:"Action"}),t.jsx(Z,{start:t.jsx(oe,{size:16}),label:h("switch_backend"),onClick:z})]})]})]})}export{De as default};
