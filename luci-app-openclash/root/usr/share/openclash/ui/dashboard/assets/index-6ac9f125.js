import{j as e,c as v,f as Ye,r as d,p as pe,e as Ee,a as Qe,b as F,d as xe,u as re,g as ye,h as H,i as Re,k as ge,l as V,R as Ie,m as Ze,n as de,o as et,q as ve,s as tt,t as K,v as st,w as nt,x as ot,y as at,z as lt,A as Se,B as it,C as ct,D as rt,E as dt,F as ut,G as mt,H as ht,I as ft,N as pt,O as xt,J as yt,K as ie,L as gt,M as vt,P as wt}from"./vendor-076c6210.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();function W(){return navigator.userAgent==="ClashX Runtime"}let C=null;class jt{constructor(t){this.instance=null,window.WebViewJavascriptBridge!=null&&(this.instance=window.WebViewJavascriptBridge),this.initBridge(n=>{this.instance=n,t()})}initBridge(t){if(!W())return t==null?void 0:t(null);if(window.WebViewJavascriptBridge!=null)return t(window.WebViewJavascriptBridge);if(window.WVJBCallbacks!=null)return window.WVJBCallbacks.push(t);window.WVJBCallbacks=[t];const n=document.createElement("iframe");n.style.display="none",n.src="https://__bridge_loaded__",document.documentElement.appendChild(n),setTimeout(()=>document.documentElement.removeChild(n),0)}async callHandler(t,n){return await new Promise(o=>{var a;(a=this.instance)==null||a.callHandler(t,n,o)})}async ping(){return await this.callHandler("ping")}async readConfigString(){return await this.callHandler("readConfigString")}async getPasteboard(){return await this.callHandler("getPasteboard")}async getAPIInfo(){return await this.callHandler("apiInfo")}async setPasteboard(t){return await this.callHandler("setPasteboard",t)}async writeConfigWithString(t){return await this.callHandler("writeConfigWithString",t)}async setSystemProxy(t){return await this.callHandler("setSystemProxy",t)}async getStartAtLogin(){return await this.callHandler("getStartAtLogin")}async getProxyDelay(t){return await this.callHandler("speedTest",t)}async setStartAtLogin(t){return await this.callHandler("setStartAtLogin",t)}async isSystemProxySet(){return await this.callHandler("isSystemProxySet")}}function bt(s){if(C!=null){s();return}C=new jt(s)}function B(s){const{title:t,children:n,className:o,style:a}=s;return e.jsxs("header",{className:v("header",o),style:a,children:[e.jsx("h1",{className:"md:text-xl",children:t}),e.jsx("div",{className:"flex flex-auto items-center justify-end",children:n})]})}function T(s){const{type:t,size:n=14,className:o,style:a}=s,l=v("clash-iconfont",`icon-${t}`,o),i={fontSize:n,...a},c={...s,className:l,style:i};return e.jsx("i",{...c})}function z(){}function Nt(s,t){const n=[],o=[];for(const a of s)t(a)?n.push(a):o.push(a);return[n,o]}function A(s){const t=["B","KiB","MiB","GiB","TiB"],n=Math.floor(Math.log(s||1)/Math.log(1024));return`${Ye(s/Math.pow(1024,n),2).toFixed(2)} ${(t==null?void 0:t[n])??""}`}function Te(s){return s.replace(/.*[/\\]/,"")}function ce(s){const{className:t,checked:n=!1,disabled:o=!1,onChange:a=z}=s,l=v("switch",{checked:n,disabled:o},t);function i(){o||a(!n)}return e.jsx("div",{className:l,onClick:i,children:e.jsx(T,{className:"switch-icon font-bold",type:"check",size:20})})}const U=d.forwardRef((s,t)=>{const{className:n,style:o,children:a}=s;return e.jsx("div",{className:v("card",n),style:o,ref:t,children:a})});function ke(s){const{options:t,value:n,onSelect:o}=s;return e.jsx("div",{className:"button-select",children:t.map(a=>e.jsx("button",{value:a.value,className:v("button-select-options",{actived:n===a.value}),onClick:()=>o==null?void 0:o(a.value),children:a.label},a.value))})}const Ct={SideBar:{Proxies:"Proxies",Overview:"Overview",Logs:"Logs",Rules:"Rules",Settings:"Setting",Connections:"Connections",Version:"Version"},Settings:{title:"Settings",labels:{startAtLogin:"Start at login",language:"language",setAsSystemProxy:"Set as system proxy",allowConnectFromLan:"Allow connect from Lan",proxyMode:"Mode",socks5ProxyPort:"Socks5 proxy port",httpProxyPort:"HTTP proxy port",mixedProxyPort:"Mixed proxy port",externalController:"External controller"},values:{cn:"中文",en:"English",global:"Global",rules:"Rules",direct:"Direct",script:"Script"},versionString:"Current ClashX is the latest version：{{version}}",checkUpdate:"Check Update",externalControllerSetting:{title:"External Controller",note:"Please note that modifying this configuration will only configure Dashboard. Will not modify your Clash configuration file. Please make sure that the external controller address matches the address in the Clash configuration file, otherwise, Dashboard will not be able to connect to Clash.",host:"Host",port:"Port",secret:"Secret"}},Logs:{title:"Logs",levelLabel:"Log level"},Rules:{title:"Rules",providerTitle:"Providers",providerUpdateTime:"Last updated at",ruleCount:"Rule count"},Connections:{title:"Connections",keepClosed:"Keep closed connections",total:{text:"total",upload:"upload",download:"download"},closeAll:{title:"Warning",content:"This would close all connections"},filter:{all:"All"},columns:{host:"Host",network:"Network",type:"Type",chains:"Chains",process:"Process",rule:"Rule",time:"Time",speed:"Speed",upload:"Upload",download:"Download",sourceIP:"Source IP"},info:{title:"Connection",id:"ID",host:"Host",hostEmpty:"Empty",dstIP:"IP",dstIPEmpty:"Empty",srcIP:"Source",upload:"Up",download:"Down",network:"Network",process:"Process",processPath:"Path",inbound:"Inbound",rule:"Rule",chains:"Chains",status:"Status",opening:"Open",closed:"Closed",closeConnection:"Close"}},Proxies:{title:"Proxies",editDialog:{title:"Edit Proxy",color:"Color",name:"Name",type:"Type",server:"Server",port:"Port",password:"Password",cipher:"Cipher",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"Policy Group",providerTitle:"Providers",providerUpdateTime:"Last updated at",expandText:"Expand",collapseText:"Collapse",speedTestText:"Speed Test",breakConnectionsText:"Close connections which include the group"},Modal:{ok:"Ok",cancel:"Cancel"}},Pt={SideBar:{Proxies:"代理",Overview:"总览",Logs:"日志",Rules:"规则",Settings:"设置",Connections:"连接",Version:"版本"},Settings:{title:"设置",labels:{startAtLogin:"开机时启动",language:"语言",setAsSystemProxy:"设置为系统代理",allowConnectFromLan:"允许来自局域网的连接",proxyMode:"代理模式",socks5ProxyPort:"Socks5 代理端口",httpProxyPort:"HTTP 代理端口",mixedProxyPort:"混合代理端口",externalController:"外部控制设置"},values:{cn:"中文",en:"English",global:"全局",rules:"规则",direct:"直连",script:"脚本"},versionString:"当前 ClashX 已是最新版本：{{version}}",checkUpdate:"检查更新",externalControllerSetting:{title:"编辑外部控制设置",note:"请注意，修改该配置项并不会修改你的 Clash 配置文件，请确认修改后的外部控制地址和 Clash 配置文件内的地址一致，否则会导致 Dashboard 无法连接。",host:"Host",port:"端口",secret:"密钥"}},Logs:{title:"日志",levelLabel:"日志等级"},Rules:{title:"规则",providerTitle:"规则集",providerUpdateTime:"最后更新于",ruleCount:"规则条数"},Connections:{title:"连接",keepClosed:"保留关闭连接",total:{text:"总量",upload:"上传",download:"下载"},closeAll:{title:"警告",content:"将会关闭所有连接"},filter:{all:"全部"},columns:{host:"域名",network:"网络",process:"进程",type:"类型",chains:"节点链",rule:"规则",time:"连接时间",speed:"速率",upload:"上传",download:"下载",sourceIP:"来源 IP"},info:{title:"连接信息",id:"ID",host:"域名",hostEmpty:"空",dstIP:"IP",dstIPEmpty:"空",srcIP:"来源",upload:"上传",download:"下载",network:"网络",process:"进程",processPath:"路径",inbound:"入口",rule:"规则",chains:"代理",status:"状态",opening:"连接中",closed:"已关闭",closeConnection:"关闭连接"}},Proxies:{title:"代理",editDialog:{title:"编辑代理",color:"颜色",name:"名字",type:"类型",server:"服务器",port:"端口",password:"密码",cipher:"加密方式",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"策略组",providerTitle:"代理集",providerUpdateTime:"最后更新于",expandText:"展开",collapseText:"收起",speedTestText:"测速",breakConnectionsText:"切换时打断包含策略组的连接"},Modal:{ok:"确 定",cancel:"取 消"}},De={en_US:Ct,zh_CN:Pt},St=Object.keys(De);function kt(){for(const s of window.navigator.languages){if(s.includes("zh"))return"zh_CN";if(s.includes("us"))return"en_US"}return"en_US"}function we(s){return d.useMemo(()=>{function n(o,a){if(typeof o=="string")s(l=>{const i=o,c=a;l[i]=c});else if(typeof o=="function"){const l=o;s(i=>l(i))}else typeof o=="object"&&s(l=>pe(l,i=>{const c=o;for(const r of Object.keys(c)){const f=r;i[f]=c[f]}}))}return n},[s])}class Me{constructor(t){this.EE=new Ee,this.innerBuffer=[],this.url="",this.connection=null,this.config=Object.assign({bufferLength:0,retryInterval:5e3},t)}connectWebsocket(){if(!this.url)return;const t=new URL(this.url);this.connection=new WebSocket(t.toString()),this.connection.addEventListener("message",n=>{const o=JSON.parse(n.data);this.EE.emit("data",[o]),this.config.bufferLength>0&&(this.innerBuffer.push(o),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}),this.connection.addEventListener("error",n=>{var o;this.EE.emit("error",n),(o=this.connection)==null||o.close(),setTimeout(this.connectWebsocket,this.config.retryInterval)})}connect(t){var n;this.url===t&&this.connection||(this.url=t,(n=this.connection)==null||n.close(),this.connectWebsocket())}subscribe(t,n){this.EE.addListener(t,n)}unsubscribe(t,n){this.EE.removeListener(t,n)}buffer(){return this.innerBuffer.slice()}destory(){var t;this.EE.removeAllListeners(),(t=this.connection)==null||t.close(),this.connection=null}}class Lt{constructor(t,n){this.axiosClient=Qe.create({baseURL:t,headers:n?{Authorization:`Bearer ${n}`}:{}})}async getConfig(){return await this.axiosClient.get("configs")}async updateConfig(t){return await this.axiosClient.patch("configs",t)}async getRules(){return await this.axiosClient.get("rules")}async getProxyProviders(){const t=await this.axiosClient.get("providers/proxies",{validateStatus(n){return n>=200&&n<300||n===404}});return t.status===404&&(t.data={providers:{}}),t}async getRuleProviders(){return await this.axiosClient.get("providers/rules")}async updateProvider(t){return await this.axiosClient.put(`providers/proxies/${encodeURIComponent(t)}`)}async updateRuleProvider(t){return await this.axiosClient.put(`providers/rules/${encodeURIComponent(t)}`)}async healthCheckProvider(t){return await this.axiosClient.get(`providers/proxies/${encodeURIComponent(t)}/healthcheck`)}async getProxies(){return await this.axiosClient.get("proxies")}async getProxy(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}`)}async getVersion(){return await this.axiosClient.get("version")}async getProxyDelay(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}/delay`,{params:{timeout:5e3,url:"http://www.gstatic.com/generate_204"}})}async closeAllConnections(){return await this.axiosClient.delete("connections")}async closeConnection(t){return await this.axiosClient.delete(`connections/${t}`)}async getConnections(){return await this.axiosClient.get("connections")}async changeProxySelected(t,n){return await this.axiosClient.put(`proxies/${encodeURIComponent(t)}`,{name:n})}}const $t=F(async()=>{if(!W())return null;const s=await C.getAPIInfo();return{hostname:s.host,port:s.port,secret:s.secret,protocol:"http:"}}),Ae=xe("externalControllers",[]);function X(){var f,h,p,x;const s=re($t),t=ye(),n=re(Ae);if(s!=null)return s;let o;{const u=document.querySelector('meta[name="external-controller"]');((f=u==null?void 0:u.content)==null?void 0:f.match(/^https?:/))!=null&&(o=new URL(u.content))}const a=new URLSearchParams(t.search),l=a.get("host")??((h=n==null?void 0:n[0])==null?void 0:h.hostname)??(o==null?void 0:o.hostname)??"127.0.0.1",i=a.get("port")??((p=n==null?void 0:n[0])==null?void 0:p.port)??(o==null?void 0:o.port)??"9090",c=a.get("secret")??((x=n==null?void 0:n[0])==null?void 0:x.secret)??(o==null?void 0:o.username)??"",r=a.get("protocol")??l==="127.0.0.1"?"http:":(o==null?void 0:o.protocol)??window.location.protocol;return{hostname:l,port:i,secret:c,protocol:r}}const Et=F({key:"",instance:null});function $(){const{hostname:s,port:t,secret:n,protocol:o}=X(),[a,l]=H(Et),i=`${o}//${s}:${t}?secret=${n}`;if(a.key===i)return a.instance;const c=new Lt(`${o}//${s}:${t}`,n);return l({key:i,instance:c}),c}const je=F(!0),Rt=xe("language",void 0);function P(){const[s,t]=H(Rt),n=d.useMemo(()=>s??kt(),[s]),o=d.useCallback(function(a){function l(i){return et(De[n][a],i)}return{t:l}},[n]);return{lang:n,locales:St,setLang:t,translation:o}}const ze=F({version:"",premium:!1});function He(){const[s,t]=H(ze),n=$(),o=ge(je);return V([n],async function(){const a=await Ie.fromPromise(n.getVersion(),l=>l);o(a.isOk()),t(a.isErr()?{version:"",premium:!1}:{version:a.value.data.version,premium:!!a.value.data.premium})}),s}function Ue(){const[{premium:s}]=H(ze),t=$(),{data:n,mutate:o}=V(["/providers/rule",t,s],async()=>{if(!s)return[];const a=await t.getRuleProviders();return Object.keys(a.data.providers).map(l=>a.data.providers[l])});return{providers:n??[],update:o}}const It=xe("profile",{breakConnections:!1,logLevel:""});function Z(){const[s,t]=H(It),n=d.useCallback(o=>{t(pe(s,o))},[s,t]);return{data:s,set:we(n)}}const Oe=F([]);function Be(){const[s,t]=H(Oe),n=$(),{data:o,mutate:a}=V(["/providers/proxy",n],async()=>{const l=await n.getProxyProviders();return Object.keys(l.data.providers).map(i=>l.data.providers[i]).filter(i=>i.name!=="default").filter(i=>i.vehicleType!=="Compatible")});return d.useEffect(()=>{t(o??[])},[o,t]),{providers:s,update:a}}function ee(){const s=$(),{data:t,mutate:n}=V(["/config",s],async()=>{const a=(await s.getConfig()).data;return{port:a.port,socksPort:a["socks-port"],mixedPort:a["mixed-port"]??0,redirPort:a["redir-port"],mode:a.mode.toLowerCase(),logLevel:a["log-level"],allowLan:a["allow-lan"]}});return{general:t??{},update:n}}const Fe=Re({proxies:[],groups:[],global:{name:"GLOBAL",type:"Selector",now:"",history:[],all:[]}});function te(){const[s,t]=H(Fe),n=we(t),o=$(),{mutate:a}=V(["/proxies",o],async()=>{const i=await o.getProxies(),c=i.data.proxies.GLOBAL;c.name="GLOBAL";const r=new Set(["Selector","URLTest","Fallback","LoadBalance"]),f=new Set(["DIRECT","REJECT","GLOBAL"]),h=c.all.filter(u=>!f.has(u)).map(u=>({...i.data.proxies[u],name:u})),[p,x]=Nt(h,u=>!r.has(u.type));n({proxies:p,groups:x,global:c})}),l=d.useCallback((i,c)=>{n(r=>{i==="GLOBAL"&&(r.global.now=c);for(const f of r.groups)f.name===i&&(f.now=c)})},[n]);return{proxies:s.proxies,groups:s.groups,global:s.global,update:a,markProxySelected:l,set:n}}const Tt=F(s=>{const t=s(Fe),n=s(Oe),o=new Map;for(const a of t.proxies)o.set(a.name,a);for(const a of n)for(const l of a.proxies)o.set(l.name,l);return o});function Ve(){const{data:s,mutate:t}=V("/clashx",async()=>{if(!W())return{isClashX:!1,startAtLogin:!1,systemProxy:!1};const n=await(C==null?void 0:C.getStartAtLogin())??!1,o=await(C==null?void 0:C.isSystemProxySet())??!1;return{startAtLogin:n,systemProxy:o,isClashX:!0}});return{data:s,update:t}}const Dt=Re([]);function Mt(){const[s,t]=H(Dt),n=we(t),o=$();async function a(){const l=await o.getRules();n(l.data.rules)}return{rules:s,update:a}}const At=F(new Me({bufferLength:200}));function _e(){const s=X(),{general:t}=ee(),{data:{logLevel:n}}=Z(),o=re(At),a=n||t.logLevel,l=Ze(`${s.protocol}//${s.hostname}:${s.port}/logs?level=${a}&secret=${encodeURIComponent(s.secret)}`),i=de(s);return d.useEffect(()=>{if(a){const c=i.current,f=`${c.protocol==="http:"?"ws:":"wss:"}//${c.hostname}:${c.port}/logs?level=${a}&token=${encodeURIComponent(c.secret)}`;o.connect(f)}},[i,o,a,l]),o}function zt(){const s=X(),t=d.useRef(new Me({bufferLength:200})),o=`${s.protocol==="http:"?"ws:":"wss:"}//${s.hostname}:${s.port}/connections?token=${encodeURIComponent(s.secret)}`;return d.useEffect(()=>{t.current.connect(o)},[o]),t.current}function Ht(s){const{className:t,data:n,onClick:o,select:a,canClick:l,errSet:i,rowHeight:c}=s,{translation:r}=P(),{t:f}=r("Proxies"),[h,p]=d.useState(!1),[x,u]=d.useState(!1),w=d.useRef(null);d.useLayoutEffect(()=>{var k;u((((k=w==null?void 0:w.current)==null?void 0:k.offsetHeight)??0)>30)},[]);const S=h?"auto":c,b=l?o:z;function E(){p(!h)}const R=n.map(k=>{const O=v({"tags-selected":a===k,"cursor-pointer":l,error:i==null?void 0:i.has(k)});return e.jsx("li",{className:O,onClick:()=>b(k),children:k},k)});return e.jsxs("div",{className:v("flex items-start overflow-y-hidden",t),style:{height:S},children:[e.jsx("ul",{ref:w,className:v("tags",{expand:h}),children:R}),x&&e.jsx("span",{className:"h-7 cursor-pointer select-none px-5 leading-7",onClick:E,children:f(h?"collapseText":"expandText")})]})}function _(s){const{className:t,style:n,value:o="",align:a="center",inside:l=!1,autoFocus:i=!1,type:c="text",disabled:r=!1,onChange:f=z,onBlur:h=z,onEnter:p=z}=s,x=v("input",`text-${a}`,{"focus:shadow-none":l},t);function u(w){w.code==="Enter"&&p(w)}return e.jsx("input",{disabled:r,className:x,style:n,value:o,autoFocus:i,type:c,onChange:w=>f(w.target.value,w),onBlur:h,onKeyDown:u})}function Ut(s){const{value:t,options:n,onSelect:o,disabled:a,className:l,style:i}=s,c=d.useRef(document.createElement("div")),r=d.useRef(null),[f,h]=d.useState(!1),[p,x]=d.useState({});d.useLayoutEffect(()=>{const b=r.current.getBoundingClientRect();x({top:Math.floor(b.top+b.height)+6,left:Math.floor(b.left)-10})},[]),d.useLayoutEffect(()=>{const b=c.current;return document.body.appendChild(b),()=>{document.body.removeChild(b)}},[]);function u(){a||h(!f)}const w=d.useMemo(()=>n.find(b=>b.value===t),[t,n]),S=e.jsx("div",{className:v("select-list",{"select-list-show":f}),style:p,children:e.jsx("ul",{className:"list",children:n.map(b=>e.jsx(Ot,{className:v({selected:b.value===t}),onClick:E=>{o==null||o(b.value,E),h(!1)},disabled:b.disabled,value:b.value,children:b.label},b.key??b.value))})});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:v("select",{disabled:a},l),style:i,ref:r,onClick:u,children:[w==null?void 0:w.label,e.jsx(T,{type:"triangle-down"})]}),ve.createPortal(S,c.current)]})}function Ot(s){const{className:t,style:n,disabled:o=!1,children:a,onClick:l=z}=s,i=v("option",{disabled:o},t);return e.jsx("li",{className:i,style:n,onClick:l,children:a})}function We(s){const{show:t=!0,title:n="Modal",size:o="small",footer:a=!0,onOk:l=z,onClose:i=z,bodyClassName:c,bodyStyle:r,className:f,style:h,children:p}=s,{translation:x}=P(),{t:u}=x("Modal"),w=d.useRef(document.createElement("div")),S=d.useRef(null);d.useLayoutEffect(()=>{const R=w.current;return document.body.appendChild(R),()=>{document.body.removeChild(R)}},[]);function b(R){R.target===S.current&&i()}const E=e.jsx("div",{className:v("modal-mask",{"modal-show":t}),ref:S,onMouseDown:b,children:e.jsxs("div",{className:v("modal",`modal-${o}`,f),style:h,children:[e.jsx("div",{className:"modal-title",children:n}),e.jsx("div",{className:v("modal-body",c),style:r,children:p}),a&&e.jsxs("div",{className:"footer",children:[e.jsx(ue,{onClick:()=>i(),children:u("cancel")}),e.jsx(ue,{type:"primary",onClick:()=>l(),children:u("ok")})]})]})});return ve.createPortal(E,w.current)}const Bt={success:"check",info:"info",warning:"info",error:"close"};function Ft(s){const{message:t="",type:n="info",inside:o=!1,children:a,className:l,style:i}=s,c=v("alert",`alert-${o?"note":"box"}-${n}`,l);return e.jsxs("div",{className:c,style:i,children:[e.jsx("span",{className:"alert-icon",children:e.jsx(T,{type:Bt[n],size:26})}),t?e.jsx("p",{className:"alert-message",children:t}):e.jsx("div",{className:"alert-message",children:a})]})}function ue(s){const{type:t="normal",onClick:n=z,children:o,className:a,style:l,disiabled:i}=s,c=v("button",`button-${t}`,a,{"button-disabled":i});return e.jsx("button",{className:c,style:l,onClick:n,disabled:i,children:o})}function Y(s){const[t,n]=tt(s),o=d.useMemo(()=>{function a(l,i){typeof l=="string"?n(c=>{const r=l,f=i;c[r]=f}):typeof l=="function"?n(l):typeof l=="object"&&n(c=>{const r=l;for(const f of Object.keys(r)){const h=f;c[h]=r[h]}})}return a},[n]);return[t,o]}function Vt(s,t=0){if(s.length<2)throw new Error("List requires at least two elements");const[n,o]=d.useState(t);function a(){o((n+1)%s.length)}return{current:d.useMemo(()=>s[n],[s,n]),next:a}}function be(s=!1){const[t,n]=d.useState(s);function o(){n(!1)}function a(){n(!0)}return{visible:t,hide:o,show:a}}function Ge(s){const{className:t,checked:n=!1,onChange:o=z}=s,a=v("checkbox",{checked:n},t);function l(){o(!n)}return e.jsxs("div",{className:a,onClick:l,children:[e.jsx(T,{className:"checkbox-icon",type:"check",size:18}),e.jsx("div",{children:s.children})]})}function Q(s){const{color:t,className:n,style:o}=s,a=v("tag",n),l={color:t,...o},i={...s,className:a,style:l};return e.jsx("span",{...i,children:s.children})}function _t(s){const t=v("spinner",s.className);return e.jsxs("div",{className:t,children:[e.jsx("div",{className:"spinner-circle",children:e.jsx("div",{className:"spinner-inner"})}),e.jsx("div",{className:"spinner-circle",children:e.jsx("div",{className:"spinner-inner"})}),e.jsx("div",{className:"spinner-circle",children:e.jsx("div",{className:"spinner-inner"})}),e.jsx("div",{className:"spinner-circle",children:e.jsx("div",{className:"spinner-inner"})}),e.jsx("div",{className:"spinner-circle",children:e.jsx("div",{className:"spinner-inner"})})]})}function Je(s){const t=v("loading","visible",s.className);return s.visible?e.jsx("div",{className:t,children:e.jsx(_t,{className:s.spinnerClassName})}):null}function Wt(s){var a;const t=d.useRef(document.createElement("div"));d.useLayoutEffect(()=>{const l=t.current;return document.body.appendChild(l),()=>{document.body.removeChild(l)}},[]);const n="absolute h-full right-0 transition-transform transform translate-x-full duration-100 pointer-events-auto",o=e.jsx("div",{className:v(s.className,"z-9999 pointer-events-none absolute inset-0"),children:e.jsx(U,{className:v(n,s.bodyClassName,{"translate-x-0":s.visible}),style:{width:s.width??400},children:s.children})});return ve.createPortal(o,((a=s.containerRef)==null?void 0:a.current)??t.current)}K.extend(st);function Ne(s,t){const n=t==="en_US"?"en":"zh-cn";return K(s).locale(n).from(K())}function Gt(s){const{translation:t}=P(),n=d.useMemo(()=>t("Connections").t,[t]),{className:o,style:a}=s,l=v("flex flex-wrap px-1",o);function i(c){var r;(r=s.onChange)==null||r.call(s,c)}return e.jsxs("div",{className:l,style:a,children:[e.jsx("div",{className:v("connections-devices-item mb-2 pt-2",{selected:s.selected===""}),onClick:()=>i(""),children:n("filter.all")}),s.devices.map(c=>e.jsxs("div",{className:v("connections-devices-item mb-2 pt-2",{selected:s.selected===c.label}),onClick:()=>i(c.label),children:[c.label," (",c.number,")"]},c.label))]})}function Jt(s){var o,a,l,i,c,r,f,h,p,x,u;const{translation:t}=P(),n=d.useMemo(()=>t("Connections").t,[t]);return e.jsxs("div",{className:v(s.className,"flex flex-col overflow-y-auto text-sm"),children:[e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.id")}),e.jsx("span",{className:"font-mono",children:s.connection.id})]}),e.jsxs("div",{className:"my-3 flex justify-between",children:[e.jsxs("div",{className:"flex flex-1",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.network")}),e.jsx("span",{className:"font-mono",children:(o=s.connection.metadata)==null?void 0:o.network})]}),e.jsxs("div",{className:"flex flex-1",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.inbound")}),e.jsx("span",{className:"font-mono",children:(a=s.connection.metadata)==null?void 0:a.type})]})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.host")}),e.jsx("span",{className:"flex-1 break-all font-mono",children:(l=s.connection.metadata)!=null&&l.host?`${s.connection.metadata.host}:${(i=s.connection.metadata)==null?void 0:i.destinationPort}`:n("info.hostEmpty")})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.dstIP")}),e.jsx("span",{className:"font-mono",children:(c=s.connection.metadata)!=null&&c.destinationIP?`${s.connection.metadata.destinationIP}:${(r=s.connection.metadata)==null?void 0:r.destinationPort}`:n("info.hostEmpty")})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.srcIP")}),e.jsx("span",{className:"font-mono",children:`${(f=s.connection.metadata)==null?void 0:f.sourceIP}:${(h=s.connection.metadata)==null?void 0:h.sourcePort}`})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.process")}),e.jsx("span",{className:"flex-1 break-all font-mono",children:(p=s.connection.metadata)!=null&&p.processPath?`${Te(s.connection.metadata.processPath)}`:n("info.hostEmpty")})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.processPath")}),e.jsx("span",{className:"flex-1 break-all font-mono",children:(x=s.connection.metadata)!=null&&x.processPath?`${s.connection.metadata.processPath}`:n("info.hostEmpty")})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.rule")}),e.jsx("span",{className:"font-mono",children:s.connection.rule&&`${s.connection.rule}${s.connection.rulePayload&&` :: ${s.connection.rulePayload}`}`})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.chains")}),e.jsx("span",{className:"flex-1 break-all font-mono",children:(u=s.connection.chains)==null?void 0:u.slice().reverse().join(" / ")})]}),e.jsxs("div",{className:"my-3 flex justify-between",children:[e.jsxs("div",{className:"flex flex-1",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.upload")}),e.jsx("span",{className:"font-mono",children:A(s.connection.upload??0)})]}),e.jsxs("div",{className:"flex flex-1",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.download")}),e.jsx("span",{className:"font-mono",children:A(s.connection.download??0)})]})]}),e.jsxs("div",{className:"my-3 flex",children:[e.jsx("span",{className:"w-20 font-bold",children:n("info.status")}),e.jsx("span",{className:"font-mono",children:s.connection.completed?e.jsx("span",{className:"text-red",children:n("info.closed")}):e.jsx("span",{className:"text-green",children:n("info.opening")})})]})]})}class Xt{constructor(){this.connections=new Map,this.saveDisconnection=!1}appendToSet(t){var o;const n=t.reduce((a,l)=>a.set(l.id,l),new Map);for(const a of this.connections.keys())if(!n.has(a))if(!this.saveDisconnection)this.connections.delete(a);else{const l=this.connections.get(a);l!=null&&this.connections.set(a,pe(l,i=>{i.completed=!0,i.uploadSpeed=0,i.downloadSpeed=0}))}for(const a of n.keys()){if(!this.connections.has(a)){this.connections.set(a,{...n.get(a),uploadSpeed:0,downloadSpeed:0});continue}const l=this.connections.get(a),i=n.get(a);(o=this.connections)==null||o.set(a,{...i,uploadSpeed:i.upload-l.upload,downloadSpeed:i.download-l.download})}}toggleSave(){var t,n;if(this.saveDisconnection){this.saveDisconnection=!1;for(const o of this.connections.keys())(n=(t=this.connections)==null?void 0:t.get(o))!=null&&n.completed&&this.connections.delete(o)}else this.saveDisconnection=!0;return this.saveDisconnection}getConnections(){return[...this.connections.values()]}}function qt(){const s=d.useMemo(()=>new Xt,[]),t=d.useRef(!0),[n,o]=d.useState([]),[a,l]=d.useState(!1),i=d.useCallback(function(r){s.appendToSet(r),t.current&&o(s.getConnections()),t.current=!t.current},[s]),c=d.useCallback(function(){const r=s.toggleSave();l(r),r||o(s.getConnections()),t.current=!0},[s]);return{connections:n,feed:i,toggleSave:c,save:a}}const g={Host:"host",Network:"network",Process:"process",Type:"type",Chains:"chains",Rule:"rule",Speed:"speed",Upload:"upload",Download:"download",SourceIP:"sourceIP",Time:"time"},Kt=new Set([g.Network,g.Type,g.Speed,g.Upload,g.Download,g.SourceIP,g.Time,g.Process]);function Yt(s,t){switch(!0){case(s===0&&t===0):return"-";case(s!==0&&t!==0):return`↑ ${A(s)}/s ↓ ${A(t)}/s`;case s!==0:return`↑ ${A(s)}/s`;default:return`↓ ${A(t)}/s`}}const I=it();function Qt(){const{translation:s,lang:t}=P(),n=d.useMemo(()=>s("Connections").t,[s]),o=zt(),a=de(o),l=$(),i=d.useRef(null),[c,r]=Y({uploadTotal:0,downloadTotal:0}),{visible:f,show:h,hide:p}=be();function x(){l.closeAllConnections().finally(()=>p())}const{connections:u,feed:w,save:S,toggleSave:b}=qt(),E=d.useMemo(()=>u.map(m=>({id:m.id,host:`${m.metadata.host||m.metadata.destinationIP}:${m.metadata.destinationPort}`,chains:m.chains.slice().reverse().join(" / "),rule:m.rulePayload?`${m.rule} :: ${m.rulePayload}`:m.rule,time:new Date(m.start).getTime(),upload:m.upload,download:m.download,sourceIP:m.metadata.sourceIP,type:m.metadata.type,network:m.metadata.network.toUpperCase(),process:m.metadata.processPath,speed:{upload:m.uploadSpeed,download:m.downloadSpeed},completed:!!m.completed,original:m})),[u]),R=d.useMemo(()=>{const m=nt(u,"metadata.sourceIP");return Object.keys(m).map(N=>({label:N,number:m[N].length})).sort((N,y)=>N.label.localeCompare(y.label))},[u]),k=d.useRef(null),O=ot(k,{threshold:[1]}),se=d.useMemo(()=>[I.accessor(g.Host,{minSize:260,size:260,header:n(`columns.${g.Host}`)}),I.accessor(g.Network,{minSize:80,size:80,header:n(`columns.${g.Network}`)}),I.accessor(g.Type,{minSize:100,size:100,header:n(`columns.${g.Type}`)}),I.accessor(g.Chains,{minSize:200,size:200,header:n(`columns.${g.Chains}`)}),I.accessor(g.Rule,{minSize:140,size:140,header:n(`columns.${g.Rule}`)}),I.accessor(g.Process,{minSize:100,size:100,header:n(`columns.${g.Process}`),cell:m=>m.getValue()?Te(m.getValue()):"-"}),I.accessor(m=>[m.speed.upload,m.speed.download],{id:g.Speed,header:n(`columns.${g.Speed}`),minSize:200,size:200,sortDescFirst:!0,sortingFn(m,N){var J,Pe;const y=((J=m.original)==null?void 0:J.speed)??{upload:0,download:0},M=((Pe=N.original)==null?void 0:Pe.speed)??{upload:0,download:0};return y.download===M.download?y.upload-M.upload:y.download-M.download},cell:m=>Yt(m.getValue()[0],m.getValue()[1])}),I.accessor(g.Upload,{minSize:100,size:100,header:n(`columns.${g.Upload}`),cell:m=>A(m.getValue())}),I.accessor(g.Download,{minSize:100,size:100,header:n(`columns.${g.Download}`),cell:m=>A(m.getValue())}),I.accessor(g.SourceIP,{minSize:140,size:140,header:n(`columns.${g.SourceIP}`),filterFn:"equals"}),I.accessor(g.Time,{minSize:120,size:120,header:n(`columns.${g.Time}`),cell:m=>Ne(new Date(m.getValue()),t),sortingFn:(m,N)=>{var y,M;return(((y=N.original)==null?void 0:y.time)??0)-(((M=m.original)==null?void 0:M.time)??0)}})],[t,n]);d.useLayoutEffect(()=>{function m(N){for(const y of N)r({uploadTotal:y.uploadTotal,downloadTotal:y.downloadTotal}),w(y.connections)}return o==null||o.subscribe("data",m),()=>{o==null||o.unsubscribe("data",m)}},[o,w,r]),at(()=>{var m;(m=a.current)==null||m.destory()});const G=lt({data:E,columns:se,getCoreRowModel:ct(),getSortedRowModel:rt(),getFilteredRowModel:dt(),initialState:{sorting:[{id:g.Time,desc:!1}]},columnResizeMode:"onChange",enableColumnResizing:!0}),q=G.getHeaderGroups()[0],[ne,oe]=d.useState("");function ae(m){oe(m),G.getColumn(g.SourceIP).setFilterValue(m||void 0)}const[D,L]=Y({visible:!1,selectedID:"",connection:{}});function le(){L(m=>{m.connection.completed=!0}),l.closeConnection(D.selectedID)}const j=de(D.connection);d.useEffect(()=>{var N;const m=(N=E.find(y=>y.id===D.selectedID))==null?void 0:N.original;m?L(y=>{y.connection={...m},D.selectedID===j.current.id&&(y.connection.completed=j.current.completed)}):Object.keys(j.current).length!==0&&!j.current.completed&&L(y=>{y.connection.completed=!0})},[E,D.selectedID,j,L]);const Ce=d.useMemo(()=>((O==null?void 0:O.intersectionRatio)??0)<1,[O]),qe=q.headers.map((m,N)=>{const y=m.column,M=y.id;return e.jsxs("th",{className:v("connections-th",{resizing:y.getIsResizing(),fixed:y.id===g.Host,shadow:Ce&&y.id===g.Host}),style:{width:m.getSize()},ref:y.id===g.Host?k:void 0,children:[e.jsxs("div",{onClick:y.getToggleSortingHandler(),children:[Se(m.column.columnDef.header,m.getContext()),y.getIsSorted()!==!1?y.getIsSorted()==="desc"?" ↓":" ↑":null]}),N!==q.headers.length-1&&e.jsx("div",{onMouseDown:m.getResizeHandler(),onTouchStart:m.getResizeHandler(),className:"connections-resizer"})]},M)}),Ke=G.getRowModel().rows.map(m=>{var N;return e.jsx("tr",{className:"cursor-default select-none",onClick:()=>{var y;return L({visible:!0,selectedID:(y=m.original)==null?void 0:y.id})},children:m.getAllCells().map(y=>{var J;const M=v("connections-block",{"text-center":Kt.has(y.column.id),completed:(J=m.original)==null?void 0:J.completed},{fixed:y.column.id===g.Host,shadow:Ce&&y.column.id===g.Host});return e.jsx("td",{className:M,style:{width:y.column.getSize()},children:Se(y.column.columnDef.cell,y.getContext())},y.column.id)})},(N=m.original)==null?void 0:N.id)});return e.jsxs("div",{className:"page !h-100vh",children:[e.jsxs(B,{title:n("title"),children:[e.jsx("span",{className:"connections-filter flex-1 cursor-default",children:`(${n("total.text")}: ${n("total.upload")} ${A(c.uploadTotal)} ${n("total.download")} ${A(c.downloadTotal)})`}),e.jsx(Ge,{className:"connections-filter",checked:S,onChange:b,children:n("keepClosed")}),e.jsx(T,{className:"connections-filter dangerous",onClick:h,type:"close-all",size:20})]}),R.length>1&&e.jsx(Gt,{devices:R,selected:ne,onChange:ae}),e.jsx(U,{ref:i,className:"connections-card relative",children:e.jsx("div",{className:"min-h-full min-w-full overflow-auto",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsx("tr",{className:"connections-header",children:qe})}),e.jsx("tbody",{children:Ke})]})})}),e.jsx(We,{title:n("closeAll.title"),show:f,onClose:p,onOk:x,children:n("closeAll.content")}),e.jsxs(Wt,{containerRef:i,bodyClassName:"flex flex-col",visible:D.visible,width:450,children:[e.jsxs("div",{className:"flex h-8 items-center justify-between",children:[e.jsx("span",{className:"pl-3 font-bold",children:n("info.title")}),e.jsx(T,{type:"close",size:16,className:"cursor-pointer",onClick:()=>L("visible",!1)})]}),e.jsx(Jt,{className:"mt-3 px-5",connection:D.connection}),e.jsx("div",{className:"mt-3 flex justify-end pr-3",children:e.jsx(ue,{type:"danger",disiabled:D.connection.completed,onClick:()=>le(),children:n("info.closeConnection")})})]})]})}function Zt(){const{translation:s}=P(),{t}=s("Settings"),{hostname:n,port:o,secret:a}=X(),[l,i]=H(je),[c,r]=Y({hostname:"",port:"",secret:""});d.useEffect(()=>{r({hostname:n,port:o,secret:a})},[n,o,a,r]);const f=ge(Ae);function h(){const{hostname:p,port:x,secret:u}=c;f([{hostname:p,port:x,secret:u}])}return e.jsxs(We,{show:!l,title:t("externalControllerSetting.title"),bodyClassName:"external-controller",onClose:()=>i(!0),onOk:h,children:[e.jsx(Ft,{type:"info",inside:!0,children:e.jsx("p",{children:t("externalControllerSetting.note")})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"my-1 w-14 font-bold md:my-3",children:t("externalControllerSetting.host")}),e.jsx(_,{className:"my-1 flex-1 md:my-3",align:"left",inside:!0,value:c.hostname,onChange:p=>r("hostname",p),onEnter:h})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"my-1 w-14 font-bold md:my-3",children:t("externalControllerSetting.port")}),e.jsx(_,{className:"my-1 w-14 flex-1 md:my-3",align:"left",inside:!0,value:c.port,onChange:p=>r("port",p),onEnter:h})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"my-1 w-14 font-bold md:my-3",children:t("externalControllerSetting.secret")}),e.jsx(_,{className:"my-1 w-14 flex-1 md:my-3",align:"left",inside:!0,value:c.secret,onChange:p=>r("secret",p),onEnter:h})]})]})}const es=[{label:"Default",value:""},{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warn",value:"warning"},{label:"Error",value:"error"},{label:"Silent",value:"silent"}],ts=new Map([["debug","text-teal-500"],["info","text-sky-500"],["warning","text-pink-500"],["error","text-rose-500"]]);function ss(){var x;const s=d.useRef(null),t=d.useRef([]),[n,o]=d.useState([]),{translation:a}=P(),{data:{logLevel:l},set:i}=Z(),{general:{logLevel:c}}=ee(),{t:r}=a("Logs"),f=_e(),h=d.useRef(((x=s.current)==null?void 0:x.scrollHeight)??0),p=ut(c)==="silent";return d.useLayoutEffect(()=>{const u=s.current;u!=null&&h.current===u.scrollTop+u.clientHeight&&(u.scrollTop=u.scrollHeight-u.clientHeight),h.current=(u==null?void 0:u.scrollHeight)??0}),d.useEffect(()=>{function u(w){t.current=t.current.slice().concat(w.map(S=>({...S,time:new Date}))),o(t.current)}return f!=null&&(f.subscribe("data",u),t.current=f.buffer(),o(t.current)),()=>f==null?void 0:f.unsubscribe("data",u)},[f]),e.jsxs("div",{className:"page",children:[e.jsxs(B,{title:r("title"),children:[e.jsxs("span",{className:"text-primary-darken mr-2 text-sm",children:[r("levelLabel"),":"]}),e.jsx(Ut,{disabled:p,options:es,value:p?"silent":l,onSelect:u=>i(w=>{w.logLevel=u})})]}),e.jsx(U,{className:"mt-2.5 flex flex-1 flex-col md:mt-4",children:e.jsx("ul",{className:"logs-panel",ref:s,children:n.map((u,w)=>e.jsxs("li",{className:"inline-block text-[11px] leading-5",children:[e.jsxs("span",{className:"mr-2 text-orange-400",children:["[",K(u.time).format("YYYY-MM-DD HH:mm:ss"),"]"]}),e.jsxs("span",{className:ts.get(u.type),children:["[",u.type.toUpperCase(),"]"]}),e.jsxs("span",{children:[" ",u.payload]})]},w))})})]})}var me=(s=>(s.SPEED_NOTIFY="speed-notify",s))(me||{});class ns{constructor(){this.EE=new Ee}notifySpeedTest(){this.EE.emit("speed-notify")}subscribe(t,n){this.EE.addListener(t,n)}unsubscribe(t,n){this.EE.removeListener(t,n)}}const he=new ns;const Le={"#909399":0,"#00c520":260,"#ff9a28":600,"#ff3e5e":1/0};function Xe(s){const{config:t,className:n}=s,{set:o}=te(),a=$(),l=d.useCallback(async p=>{if(W())return await(C==null?void 0:C.getProxyDelay(p))??0;const{data:{delay:x}}=await a.getProxyDelay(p);return x},[a]),i=d.useCallback(async function(){const p=await Ie.fromPromise(l(t.name),u=>u),x=p.isErr()?0:p.value;o(u=>{const w=u.proxies.find(S=>S.name===t.name);w!=null&&w.history.push({time:Date.now().toString(),delay:x})})},[t.name,l,o]),c=d.useMemo(()=>{var p;return(p=t.history)!=null&&p.length?t.history.slice(-1)[0].delay:0},[t]);d.useLayoutEffect(()=>{const p=()=>{i()};return he.subscribe(me.SPEED_NOTIFY,p),()=>he.unsubscribe(me.SPEED_NOTIFY,p)},[i]);const r=d.useMemo(()=>c===0,[c]),f=d.useMemo(()=>Object.keys(Le).find(p=>c<=Le[p]),[c]),h=r?"#E5E7EB":f;return e.jsxs("div",{className:v("proxy-item",{"opacity-50":r},n),children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:v("rounded-sm py-[3px] px-1 text-[10px] text-white",{"text-gray-600":r}),style:{backgroundColor:h},children:t.type}),e.jsx("p",{className:"proxy-name",children:t.name})]}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center space-y-3 text-[10px] md:h-[18px] md:flex-row md:justify-between md:space-y-0",children:[e.jsx("p",{children:c===0?"-":`${c}ms`}),t.udp&&e.jsx("p",{className:"rounded bg-gray-200 p-[3px] text-gray-600",children:"UDP"})]})]})}function os(s){const{markProxySelected:t}=te(),[n]=H(Tt),{data:o}=Z(),a=$(),{config:l}=s;async function i(f){if(await a.changeProxySelected(s.config.name,f),t(s.config.name,f),o.breakConnections){const h=[],p=await a.getConnections();for(const x of p.data.connections)x.chains.includes(s.config.name)&&h.push(x.id);await Promise.all(h.map(x=>a.closeConnection(x)))}}const c=d.useMemo(()=>{var h;const f=new Set;for(const p of l.all){const x=(h=n.get(p))==null?void 0:h.history;x!=null&&x.length&&x.slice(-1)[0].delay===0&&f.add(p)}return f},[l.all,n]),r=l.type==="Selector";return e.jsxs("div",{className:"proxy-group",children:[e.jsxs("div",{className:"md:h-15 mt-4 flex h-10 w-full items-center justify-between md:mt-0 md:w-auto",children:[e.jsx("span",{className:"w-35 md:w-30 h-6 overflow-hidden overflow-ellipsis whitespace-nowrap px-5",children:l.name}),e.jsx(Q,{className:"mr-5 md:mr-0",children:l.type})]}),e.jsx("div",{className:"flex-1 py-2 md:py-4",children:e.jsx(Ht,{className:"ml-5 md:ml-8",data:l.all,onClick:i,errSet:c,select:l.now,canClick:r,rowHeight:30})})]})}function as(s){const{update:t}=Be(),{translation:n,lang:o}=P(),a=$(),{provider:l}=s,{t:i}=n("Proxies"),{visible:c,hide:r,show:f}=be();function h(){f(),a.healthCheckProvider(l.name).then(async()=>await t()).finally(()=>r())}function p(){f(),a.updateProvider(l.name).then(async()=>await t()).finally(()=>r())}const x=d.useMemo(()=>l.proxies.slice().sort((u,w)=>-1*fe(u,w)),[l.proxies]);return e.jsxs(U,{className:"proxy-provider",children:[e.jsx(Je,{visible:c}),e.jsxs("div",{className:"md:flex-row md:items-center flex flex-col justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-6",children:l.name}),e.jsx(Q,{children:l.vehicleType})]}),e.jsxs("div",{className:"flex items-center pt-3 md:pt-0",children:[l.updatedAt&&e.jsx("span",{className:"text-sm",children:`${i("providerUpdateTime")}: ${Ne(new Date(l.updatedAt),o)}`}),e.jsx(T,{className:"text-red cursor-pointer pl-5",type:"healthcheck",size:18,onClick:h}),e.jsx(T,{className:"cursor-pointer pl-5",type:"update",size:18,onClick:p})]})]}),e.jsx("ul",{className:"proxies-list",children:x.map(u=>e.jsx("li",{children:e.jsx(Xe,{className:"proxy-provider-item",config:u})},u.name))})]})}const ls={[0]:"sort",[1]:"sort-ascending",[2]:"sort-descending"};function fe(s,t){const n=s.history.length>0?s.history.slice(-1)[0].delay:0;return((t.history.length>0?t.history.slice(-1)[0].delay:0)||Number.MAX_SAFE_INTEGER)-(n||Number.MAX_SAFE_INTEGER)}function is(){const{groups:s,global:t}=te(),{data:n,set:o}=Z(),{general:a}=ee(),{translation:l}=P(),{t:i}=l("Proxies"),c=d.useMemo(()=>a.mode==="global"?[t,...s]:s,[a,s,t]);return e.jsx(e.Fragment,{children:c.length!==0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx(B,{title:i("groupTitle"),children:e.jsx(Ge,{className:"text-shadow-primary text-primary-600 cursor-pointer text-sm",checked:n.breakConnections,onChange:r=>o("breakConnections",r),children:i("breakConnectionsText")})}),e.jsx(U,{className:"my-2.5 p-0 md:my-4",children:e.jsx("ul",{className:"list-none divide-y divide-gray-300",children:c.map(r=>e.jsx("li",{children:e.jsx(os,{config:r})},r.name))})})]})})}function cs(){const{providers:s}=Be(),{translation:t}=P(),{t:n}=t("Proxies");return e.jsx(e.Fragment,{children:s.length!==0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx(B,{title:n("providerTitle")}),e.jsx("ul",{className:"list-none",children:s.map(o=>e.jsx("li",{className:"my-2.5 md:my-4",children:e.jsx(as,{provider:o})},o.name))})]})})}function rs(){const{proxies:s}=te(),{translation:t}=P(),{t:n}=t("Proxies");function o(){he.notifySpeedTest()}const{current:a,next:l}=Vt([1,2,0]),i=d.useMemo(()=>{switch(a){case 2:return s.slice().sort((r,f)=>fe(r,f));case 1:return s.slice().sort((r,f)=>-1*fe(r,f));default:return s.slice()}},[a,s]),c=l;return e.jsx(e.Fragment,{children:i.length!==0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs(B,{title:n("title"),children:[e.jsx(T,{className:"ml-3",type:ls[a],onClick:c,size:20}),e.jsx(T,{className:"ml-3",type:"speed",size:20}),e.jsx("span",{className:"proxies-speed-test",onClick:o,children:n("speedTestText")})]}),e.jsx("ul",{className:"proxies-list",children:i.map(r=>e.jsx("li",{children:e.jsx(Xe,{config:r})},r.name))})]})})}function ds(){return e.jsxs("div",{className:"page",children:[e.jsx(is,{}),e.jsx(cs,{}),e.jsx(rs,{})]})}function us(s){const{update:t}=Ue(),{translation:n,lang:o}=P(),a=$(),{provider:l}=s,{t:i}=n("Rules"),{visible:c,hide:r,show:f}=be();function h(){f(),a.updateRuleProvider(l.name).then(async()=>await t()).finally(()=>r())}const p=v("rule-provider-icon",{"rule-provider-loading":c});return e.jsx("div",{className:"rule-provider",children:e.jsxs("div",{className:"rule-provider-header",children:[e.jsxs("div",{className:"rule-provider-header-part",children:[e.jsx("span",{className:"rule-provider-name",children:l.name}),e.jsx(Q,{children:l.vehicleType}),e.jsx(Q,{className:"rule-provider-behavior",children:l.behavior}),e.jsx("span",{className:"rule-provider-update",children:`${i("ruleCount")}: ${l.ruleCount}`})]}),e.jsxs("div",{className:"rule-provider-header-part",children:[l.updatedAt&&e.jsx("span",{className:"rule-provider-update",children:`${i("providerUpdateTime")}: ${Ne(new Date(l.updatedAt),o)}`}),e.jsx(T,{className:p,type:"update",size:18,onClick:h})]})]})})}function ms(){const{providers:s}=Ue(),{translation:t}=P(),{t:n}=t("Rules");return e.jsx(e.Fragment,{children:s.length!==0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx(B,{title:n("providerTitle")}),e.jsx(U,{className:"shadow-primary mt-4 divide-y rounded p-0",children:s.map(o=>e.jsx(us,{provider:o},o.name))})]})})}function hs(){const{rules:s,update:t}=Mt(),{translation:n}=P(),{t:o}=n("Rules");V("rules",t);function a({index:l,style:i}){const c=s[l];return e.jsx("li",{className:"rule-item",style:i,children:e.jsxs("div",{className:"flex py-1",children:[e.jsx("div",{className:"rule-type w-40 text-center",children:c.type}),e.jsx("div",{className:"payload flex-1 text-center",children:c.payload}),e.jsx("div",{className:"rule-proxy w-40 text-center",children:c.proxy})]})})}return e.jsxs("div",{className:"page",children:[e.jsx(ms,{}),e.jsx(B,{className:"not-first:mt-7.5",title:o("title")}),e.jsx(U,{className:"mt-2.5 flex flex-1 flex-col p-0 focus:outline-none md:mt-4",children:e.jsx(mt,{className:"min-h-120",children:({height:l,width:i})=>e.jsx(ht,{height:l,width:i,itemCount:s.length,itemSize:50,children:a})})})]})}const fs=[{label:"中文",value:"zh_CN"},{label:"English",value:"en_US"}];function ps(){const{premium:s}=He(),{data:t,update:n}=Ve(),{general:o,update:a}=ee(),l=ge(je),i=X(),{translation:c,setLang:r,lang:f}=P(),{t:h}=c("Settings"),p=$(),[x,u]=Y({socks5ProxyPort:7891,httpProxyPort:7890,mixedProxyPort:0});d.useEffect(()=>{u("socks5ProxyPort",(o==null?void 0:o.socksPort)??0),u("httpProxyPort",(o==null?void 0:o.port)??0),u("mixedProxyPort",(o==null?void 0:o.mixedPort)??0)},[o,u]);async function w(j){await p.updateConfig({mode:j}),await a()}async function S(j){await(C==null?void 0:C.setStartAtLogin(j)),await n()}async function b(j){await(C==null?void 0:C.setSystemProxy(j)),await n()}function E(j){r(j)}async function R(){await p.updateConfig({port:x.httpProxyPort}),await a()}async function k(){await p.updateConfig({"socks-port":x.socks5ProxyPort}),await a()}async function O(){await p.updateConfig({"mixed-port":x.mixedProxyPort}),await a()}async function se(j){await p.updateConfig({"allow-lan":j}),await a()}const{hostname:G,port:q}=i,{allowLan:ne,mode:oe}=o,ae=(t==null?void 0:t.startAtLogin)??!1,D=(t==null?void 0:t.systemProxy)??!1,L=(t==null?void 0:t.isClashX)??!1,le=d.useMemo(()=>{const j=[{label:h("values.global"),value:"Global"},{label:h("values.rules"),value:"Rule"},{label:h("values.direct"),value:"Direct"}];return s&&j.push({label:h("values.script"),value:"Script"}),j},[h,s]);return e.jsxs("div",{className:"page",children:[e.jsx(B,{title:h("title")}),e.jsxs(U,{className:"settings-card",children:[e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:h("labels.startAtLogin")}),e.jsx(ce,{disabled:!(t!=null&&t.isClashX),checked:ae,onChange:S})]}),e.jsxs("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:h("labels.language")}),e.jsx(ke,{options:fs,value:f,onSelect:j=>E(j)})]})]}),e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:h("labels.setAsSystemProxy")}),e.jsx(ce,{disabled:!L,checked:D,onChange:b})]}),e.jsxs("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:h("labels.allowConnectFromLan")}),e.jsx(ce,{checked:ne,onChange:se})]})]})]}),e.jsxs(U,{className:"settings-card",children:[e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:h("labels.proxyMode")}),e.jsx(ke,{options:le,value:ft(oe),onSelect:w})]}),e.jsxs("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:h("labels.socks5ProxyPort")}),e.jsx(_,{className:"w-28",disabled:L,value:x.socks5ProxyPort,onChange:j=>u("socks5ProxyPort",+j),onBlur:k})]})]}),e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:h("labels.httpProxyPort")}),e.jsx(_,{className:"w-28",disabled:L,value:x.httpProxyPort,onChange:j=>u("httpProxyPort",+j),onBlur:R})]}),e.jsxs("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:h("labels.mixedProxyPort")}),e.jsx(_,{className:"w-28",disabled:L,value:x.mixedProxyPort,onChange:j=>u("mixedProxyPort",+j),onBlur:O})]})]}),e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex w-full items-center justify-between py-3 px-8 md:w-1/2",children:[e.jsx("span",{className:"label font-bold",children:h("labels.externalController")}),e.jsx("span",{className:v({"modify-btn":!L},"external-controller"),onClick:()=>!L&&l(!1),children:`${G}:${q}`})]}),e.jsx("div",{className:"w-1/2 px-8"})]})]})]})}const xs=""+new URL("logo-b453e72f.png",import.meta.url).href;function ys(s){const{routes:t}=s,{translation:n}=P(),{version:o,premium:a}=He(),{data:l}=Ve(),{t:i}=n("SideBar"),c=ye(),r=t.map(({path:f,name:h,noMobile:p})=>e.jsx("li",{className:v("item",{"no-mobile":p}),children:e.jsx(pt,{to:{pathname:f,search:c.search},className:({isActive:x})=>v({active:x}),children:i(h)})},h));return e.jsxs("div",{className:"sidebar",children:[e.jsx("img",{src:xs,alt:"logo",className:"sidebar-logo"}),e.jsx("ul",{className:"sidebar-menu",children:r}),e.jsxs("div",{className:"sidebar-version",children:[e.jsxs("span",{className:"sidebar-version-label",children:["Clash",(l==null?void 0:l.isClashX)&&"X"," ",i("Version")]}),e.jsx("span",{className:"sidebar-version-text",children:o}),a&&e.jsx("span",{className:"sidebar-version-label",children:"Premium"})]})]})}function gs(){_e();const s=ye(),t=[{path:"/proxies",name:"Proxies",element:e.jsx(ds,{})},{path:"/logs",name:"Logs",element:e.jsx(ss,{})},{path:"/rules",name:"Rules",element:e.jsx(hs,{}),noMobile:!0},{path:"/connections",name:"Connections",element:e.jsx(Qt,{}),noMobile:!0},{path:"/settings",name:"Settings",element:e.jsx(ps,{})}],n=e.jsxs("div",{className:v("app",{"not-clashx":!W()}),children:[e.jsx(ys,{routes:t}),e.jsx("div",{className:"page-container",children:e.jsx(xt,{})}),e.jsx(Zt,{})]});return e.jsx(yt,{children:e.jsxs(ie,{path:"/",element:n,children:[e.jsx(ie,{path:"/",element:e.jsx(gt,{to:{pathname:"/proxies",search:s.search},replace:!0})}),t.map(o=>e.jsx(ie,{path:o.path,element:o.element},o.path))]})})}function $e(){const s=document.getElementById("root"),t=e.jsx(d.StrictMode,{children:e.jsx(wt,{children:e.jsx(d.Suspense,{fallback:e.jsx(Je,{visible:!0}),children:e.jsx(gs,{})})})});vt(s).render(t)}W()?bt(()=>$e()):$e();
